{% extends "settings/core.html" %}

{% block content %}

{% if g.user.is_org_admin %}
<h2 class="h5">Add New User</h2>
<form id="form-invite-user" action="/settings/directory/invite" method="post">
  <label for="input-new-user-email">Email</label>
  <input id="input-new-user-email" name="email" required>
</form>
<a href="javascript:void(0)" class="btn btn-primary post-form-toast" data-form="form-invite-user">Invite User
{% endif %}

<h2 class="h5">Directory</h2>

<table class="table table-striped mb-5">
  <thead class="bg-primary text-white">
    <tr>
      <th>Name</th>
      <th>Email</th>
      {% if g.user.is_org_admin %}
      <th>Enabled</th>
      <th>Full License</th>
      <th>Administrator</th>
      {% else %}
      <th>Full License</th>
      <th>Roles</th>
      {% endif %}
    </tr>
  </thead>
  {% for user in g.user.organization.users.all() %}
  <tr>
    <td>{{ user.name }}</td>
    <td><a href="mailto:{{ user.email }}">{{ user.email }}</a></td>

    {% if g.user.is_org_admin %}
    <td><input type="checkbox" class="check-toast" data-post-url="/settings/directory/toggle_enable/{{ user.base36id }}"{% if user.is_active %} checked{% endif %}{% if user==g.user %} disabled{% endif %}></td>
    <td><input type="checkbox" class="check-toast" data-post-url="/settings/directory/toggle_license/{{ user.base36id }}"{% if user.has_license %} checked{% endif %}{% if user==g.user %} disabled{% endif %}></td>
    <td><input type="checkbox" class="check-toast" data-post-url="/settings/directory/toggle_admin/{{ user.base36id }}"{% if user.is_org_admin %} checked{% endif %}{% if user==g.user %} disabled{% endif %}></td>

    {% else %}
    <td><input type="checkbox"{% if user.has_license %} checked{% endif %} disabled></td>
    <td class="text-small">{{ user.role_string }}</td>
    {% endif %}

  </tr>
  {% endfor %}
</table>

{% endblock %}
